stages:
  - test
  - build
  - intergration_tests

unittest:
  stage: test
  image: golang:1.13.7
  script:
    - go get -u github.com/jstemmer/go-junit-report
    - make unittest | go-junit-report > report.xml
  artifacts:
    reports:
      junit: report.xml

golangci-lint:
  stage: test
  image: golangci/golangci-lint
  script:
    - make check

buildall:
  stage: build
  image: golang:1.13.7
  script:
    - ./build/ci/install_protoc.sh
    - make all

intergration_tests:
  stage: intergration_tests
  image: docker:19.03.6
  script:
    - apk add bash curl
    - ./build/ci/install_golang.sh
    - ./build/ci/install_protoc.sh
    - make docker
    - make test
